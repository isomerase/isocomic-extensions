(()=>{"use strict";var e={368:function(e,t,a){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateSource=t.metadata=void 0;var s=a(596);Object.defineProperty(t,"metadata",{enumerable:!0,get:function(){return r(s).default}});const i={type:"SELECTLIST",key:"category",label:"Category",entryValues:[],entryLabels:[]},l={type:"SELECTLIST",key:"source",label:"Source",entryValues:[],entryLabels:[]},n={type:"SELECTLIST",key:"order",label:"Order",entryValues:["popular","latest"],entryLabels:["popular","latest"]},c={type:"EDITTEXT",key:"server",label:"Server"};t.CreateSource=class{constructor(e){this.preferenceList=[c],this.filterList=[i,l,n],this.baseUrl=e.prefs[c.key],this.setCategoryFilter(),this.setSources()}async setCategoryFilter(){const e=`${this.baseUrl}/api/v1/category`,t=await this.fetchJSON(e);i.entryValues=t.map((e=>e.id)),i.entryLabels=t.map((e=>e.name))}async setSources(){const e=`${this.baseUrl}/api/v1/source/list`,t=await this.fetchJSON(e);l.entryLabels=t.map((e=>e.displayName)),l.entryValues=t.map((e=>e.id))}async fetchJSON(e){if(!e.match("^https?://"))throw new Error(`Invalid url: ${e}`);return(await fetch(e)).json()}async fetchSourceMangas(e,t){if(t?.[l.key]){const a=t[l.key],r=t?.[n.key]??"popular",s=`${this.baseUrl}/api/v1/source/${a}/${r}/${e}`,i=await this.fetchJSON(s);return{mangas:this.parseMangaList(i.mangaList),totalPage:i.hasNextPage?e+1:e}}const a=t?.[i.key]??"1",r=`${this.baseUrl}/api/v1/category/${a}`,s=await this.fetchJSON(r),c=this.parseMangaList(s);return{mangas:c.slice(40*(e-1),40*e),totalPage:Math.ceil(c.length/40)}}parseMangaList(e){return e.map((e=>({url:`/api/v1/manga/${e.id}`,thumbnailUrl:this.baseUrl+e.thumbnailUrl,title:e.title})))}async fetchSourceManga(e){const t=await this.fetchSourceChapterList(e),a=await this.fetchJSON(`${this.baseUrl}${e}`);return{url:e,title:a.title,thumbnailUrl:this.baseUrl+a.thumbnailUrl,status:a.status,description:a.description,author:[a.author,"@"+a.source.displayName].filter((e=>!!e)),artist:a.artist,chapters:t,tags:a.genre.filter((e=>!!e))}}async fetchSourceChapterList(e){const t=`${this.baseUrl}${e}/chapters`;return(await this.fetchJSON(t)).map((t=>({url:`${e}/chapter/${t.index}`,title:t.name,updateAt:t.uploadDate})))}async fetchSourceChapter(e){const t=this.baseUrl+e,a=await this.fetchJSON(t),r=(s=a.pageCount,Array.from(Array(s).keys())).map((t=>this.baseUrl+`${e}/page/${t}`));var s;return{url:e,title:a.name,pages:r}}}},596:e=>{e.exports=JSON.parse('{"id":"tachidesk","name":"Tachidesk","website":"https://github.com/Suwayomi/Tachidesk-Server","version":"0.0.1","language":"all","iconUrl":"https://raw.githubusercontent.com/tachiyomiorg/tachiyomi-extensions/master/src/all/tachidesk/res/mipmap-xxhdpi/ic_launcher.png"}')}},t={},a=function a(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,a),i.exports}(368);module.exports=a})();