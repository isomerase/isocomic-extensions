(()=>{var t={321:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PicaAgent=void 0;const n=r(961),i="https://picaapi.picacomic.com";e.PicaAgent=class{constructor(t,e){this.xfetch=t,this.store=e,this.isSignIn=!1,this.store=e,this.xfetch=t}async signIn(){if(!this.isSignIn){if(!this.store.token||(0,n.isTokenExpired)(this.store.token)){if(!this.store.username||!this.store.password)throw new Error("username or password is empty");this.store.token=await this.fetchToken(this.store.username,this.store.password)}this.isSignIn=!0}}async fetch(t,e){await this.signIn();const r=e?.method??"GET",i=(0,n.buildHeaders)(t,r);return i.append("authorization",this.store.token),this.xfetch(t,{...e,headers:i})}async fetchJSON(t,e){const r=await this.fetch(t,e),n=await r.json();if(200!==n.code)throw new Error(n.message);return n}async fetchComics(t,e="dd",r=""){let n=`${i}/comics?page=${t}&s=${e}`;return r&&(n+=`&c=${encodeURIComponent(r)}`),this.fetchJSON(n)}async fetchFavoriteComics(t,e="dd"){const r=`${i}/users/favourite?s=${e}&page=${t}`;return this.fetchJSON(r)}async fetchRandomComics(t){const e=`${i}/comics/random?page=${t}`;return this.fetchJSON(e)}async fetchRandomTopComics(t){const e=await this.fetchRandomComics(t),r=e.data.comics;return r.sort(((t,e)=>t.likesCount-e.likesCount)),e.data.comics=r.slice(-3),e}async fetchEpisode(t,e){const r=`${i}/comics/${t}/eps?page=${e}`;return this.fetchJSON(r)}async fetchComic(t){const e=`${i}/comics/${t}`;return this.fetchJSON(e)}async fetchPages(t,e,r){const n=`${i}/comics/${t}/order/${e}/pages?page=${r}`;return this.fetchJSON(n)}async fetchSearchComics(t,e,r="dd",n=[]){const a=`${i}/comics/advanced-search?page=${e}`;return await this.fetchJSON(a,{method:"POST",body:JSON.stringify({keyword:t,categories:n,sort:r})})}async fetchToken(t,e){const r=`${i}/auth/sign-in`,a=await this.xfetch(r,{method:"POST",headers:(0,n.buildHeaders)(r,"POST"),body:JSON.stringify({email:t,password:e})}),o=await a.json();if(200!==o.code)throw new Error(o.message);if(!o.data?.token)throw new Error("Invalid username or password");return o.data.token}}},368:function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.CreateSource=e.metadata=void 0;const i=r(321);var a=r(596);function o(t,e){return Array.from(Array(e-t).keys()).map((e=>e+t))}Object.defineProperty(e,"metadata",{enumerable:!0,get:function(){return n(a).default}});const s=null!=globalThis.navigator?.userAgent.match(/^((?!chrome|android).)*safari/i),c=["大家都在看","牛牛不哭","那年今天","官方都在看","嗶咔漢化","全彩","長篇","同人","短篇","圓神領域","碧藍幻想","CG雜圖","純愛","百合花園","後宮閃光","單行本","姐姐系","妹妹系","SM","人妻","NTR","強暴","艦隊收藏","Love Live","SAO 刀劍神域","Fate","東方","禁書目錄","Cosplay","英語 ENG","生肉","性轉換","足の恋","非人類","耽美花園","偽娘哲學","扶他樂園","重口地帶","歐美","WEBTOON"],h={type:"SELECTLIST",key:"order",label:"排序",entryValues:["dd","da","ld","vd"],entryLabels:["新到舊","舊到新","最多收藏","最多指名"]},u={type:"SELECTLIST",key:"category",label:"分類",entryValues:c,entryLabels:c},p={type:"SELECTLIST",key:"frame",label:"頁面",entryValues:["random","favorites","randomTop"],entryLabels:["隨機","收藏","随机最赞"]},f={key:"username",label:"用戶名",type:"EDITTEXT"},d={key:"password",label:"密碼",type:"EDITTEXT"};function l(t){return{mangas:(t.docs?t.docs:t).map((t=>({url:`https://picaapi.picacomic.com/comics/${t._id}`,title:t.title,thumbnailUrl:g(t),author:t.author,tags:(t.categories??[]).concat(t.tags??[]),status:t.finished?"COMPLETED":"ONGOING"}))),totalPage:t.pages??1/0}}function g(t){const e=t.thumb??t.media,r=e.fileServer??e.file_server,n=e.path;return n.startsWith("tobeimg/")?`https://img.picacomic.com/${n.replace(/^tobeimg\//,"")}`:`${r}/static/${n.replace(/^tobs\//,"")}`}e.CreateSource=class{constructor(t){this.preferenceList=[f,d],this.filterList=[p,h,u],t.prefs.username||t.prefs.password||(t.prefs.username="hiker_share",t.prefs.password="hiker_share_12345678"),this.agent=new i.PicaAgent(s?fetch.bind(window):t.xfetch,t.prefs)}async fetchSourceMangas(t,e){const r=e?.[h.key]??"dd",n=e?.[u.key];let i;switch(e?.[p.key]){case"favorites":i=await this.agent.fetchFavoriteComics(t,r);break;case"random":i=await this.agent.fetchRandomComics(t);break;case"randomTop":i=await this.agent.fetchRandomTopComics(t);break;default:i=await this.agent.fetchComics(t,r,n)}return l(i.data.comics)}async fetchSourceChapterList(t){const e=t.split("/").pop(),r=async r=>{let n=(await this.agent.fetchEpisode(e,r)).data.eps;return[n.docs.map((e=>({title:e.title,url:`${t}/order/${e.order}`,updateAt:Date.parse(e.updated_at)}))),n.pages]};let[n,i]=await r(1);if(i>1){let t=(await Promise.all(o(2,i+1).map((t=>r(t))))).map((t=>t[0])).flat();n=n.concat(t)}return n}async fetchSourceMangaInfo(t){const e=t.split("/").pop();let r=(await this.agent.fetchComic(e)).data.comic;return{url:t,title:r.title,thumbnailUrl:g(r),author:r.author,uploader:r.chineseTeam,status:r.finished?"COMPLETED":"ONGOING",description:r.description,tags:(n=[...r.tags??[],...r.categories??[]].map((t=>t.trim())),n.filter(((t,e,r)=>r.indexOf(t)===e)))};var n}async fetchSourceManga(t){const[e,r]=await Promise.all([this.fetchSourceMangaInfo(t),this.fetchSourceChapterList(t)]);return e.chapters=r,e}async fetchSourceChapter(t){const e=t.split("/").pop(),r=t.split("/").slice(-3)[0],n=async n=>{const i=await this.agent.fetchPages(r,e,n);let a=i.data.pages,o=a.docs.map((t=>g(t)));return[{url:t,title:i.data.ep.title,pages:o},a.pages]};let[i,a]=await n(1);if(a>1){let t=(await Promise.all(o(2,a+1).map((t=>n(t))))).map((t=>t[0].pages)).flat();i.pages=i.pages.concat(t)}return i}async fetchSourceSearchMangas(t,e,r){const n=r?.order??"dd",i=r?.category?[r.category]:[];return l((await this.agent.fetchSearchComics(t,e,n,i)).data.comics)}}},961:function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.isTokenExpired=e.buildHeaders=void 0;const i=n(r(10)),a=n(r(245));e.buildHeaders=function(t,e="GET"){const r=Math.floor(Date.now()/1e3),n="f4548a0f1cd21e2c91ca8ca0752ec48d",a=function(t,e,r,n){const a=o["api-key"],s=`${t.replace("https://picaapi.picacomic.com/","")}${e}f4548a0f1cd21e2c91ca8ca0752ec48d${r}${a}`.toLowerCase();return(0,i.default)(s,"~d}$Q7$eIni=V)9\\RK/P.RM4;9[7|@/CA}b~OW!3?EV`:<>M7pddUBL5n|0/*Cn").toString()}(t,r,e),s=new Headers(o);return s.set("time",r.toString()),s.set("nonce",n),s.set("signature",a),s},e.isTokenExpired=function(t,e=6){return 1e3*((0,a.default)(t).exp-3600*e)<Date.now()};const o={"api-key":"C69BAF41DA5ABD1FFEDC6D2FEA56B","app-channel":"2","app-version":"2.2.1.3.3.4","app-uuid":"defaultUuid","app-platform":"android","app-build-version":"44","User-Agent":"okhttp/3.8.1",accept:"application/vnd.picacomic.com.v1+json","image-quality":"original","Content-Type":"application/json; charset=UTF-8"}},249:function(t,e,r){var n;t.exports=(n=n||function(t,e){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==r.g&&r.g.crypto&&(n=r.g.crypto),!n)try{n=r(480)}catch(t){}var i=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")},a=Object.create||function(){function t(){}return function(e){var r;return t.prototype=e,r=new t,t.prototype=null,r}}(),o={},s=o.lib={},c=s.Base={extend:function(t){var e=a(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},h=s.WordArray=c.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||p).stringify(this)},concat:function(t){var e=this.words,r=t.words,n=this.sigBytes,i=t.sigBytes;if(this.clamp(),n%4)for(var a=0;a<i;a++){var o=r[a>>>2]>>>24-a%4*8&255;e[n+a>>>2]|=o<<24-(n+a)%4*8}else for(var s=0;s<i;s+=4)e[n+s>>>2]=r[s>>>2];return this.sigBytes+=i,this},clamp:function(){var e=this.words,r=this.sigBytes;e[r>>>2]&=4294967295<<32-r%4*8,e.length=t.ceil(r/4)},clone:function(){var t=c.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],r=0;r<t;r+=4)e.push(i());return new h.init(e,t)}}),u=o.enc={},p=u.Hex={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],i=0;i<r;i++){var a=e[i>>>2]>>>24-i%4*8&255;n.push((a>>>4).toString(16)),n.push((15&a).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,r=[],n=0;n<e;n+=2)r[n>>>3]|=parseInt(t.substr(n,2),16)<<24-n%8*4;return new h.init(r,e/2)}},f=u.Latin1={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],i=0;i<r;i++){var a=e[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(a))}return n.join("")},parse:function(t){for(var e=t.length,r=[],n=0;n<e;n++)r[n>>>2]|=(255&t.charCodeAt(n))<<24-n%4*8;return new h.init(r,e)}},d=u.Utf8={stringify:function(t){try{return decodeURIComponent(escape(f.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return f.parse(unescape(encodeURIComponent(t)))}},l=s.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=d.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var r,n=this._data,i=n.words,a=n.sigBytes,o=this.blockSize,s=a/(4*o),c=(s=e?t.ceil(s):t.max((0|s)-this._minBufferSize,0))*o,u=t.min(4*c,a);if(c){for(var p=0;p<c;p+=o)this._doProcessBlock(i,p);r=i.splice(0,c),n.sigBytes-=u}return new h.init(r,u)},clone:function(){var t=c.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),g=(s.Hasher=l.extend({cfg:c.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,r){return new t.init(r).finalize(e)}},_createHmacHelper:function(t){return function(e,r){return new g.HMAC.init(t,r).finalize(e)}}}),o.algo={});return o}(Math),n)},10:function(t,e,r){var n;t.exports=(n=r(249),r(153),r(824),n.HmacSHA256)},824:function(t,e,r){var n,i,a;t.exports=(i=(n=r(249)).lib.Base,a=n.enc.Utf8,void(n.algo.HMAC=i.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=a.parse(e));var r=t.blockSize,n=4*r;e.sigBytes>n&&(e=t.finalize(e)),e.clamp();for(var i=this._oKey=e.clone(),o=this._iKey=e.clone(),s=i.words,c=o.words,h=0;h<r;h++)s[h]^=1549556828,c[h]^=909522486;i.sigBytes=o.sigBytes=n,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher,r=e.finalize(t);return e.reset(),e.finalize(this._oKey.clone().concat(r))}})))},153:function(t,e,r){var n;t.exports=(n=r(249),function(t){var e=n,r=e.lib,i=r.WordArray,a=r.Hasher,o=e.algo,s=[],c=[];!function(){function e(e){for(var r=t.sqrt(e),n=2;n<=r;n++)if(!(e%n))return!1;return!0}function r(t){return 4294967296*(t-(0|t))|0}for(var n=2,i=0;i<64;)e(n)&&(i<8&&(s[i]=r(t.pow(n,.5))),c[i]=r(t.pow(n,1/3)),i++),n++}();var h=[],u=o.SHA256=a.extend({_doReset:function(){this._hash=new i.init(s.slice(0))},_doProcessBlock:function(t,e){for(var r=this._hash.words,n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],p=r[6],f=r[7],d=0;d<64;d++){if(d<16)h[d]=0|t[e+d];else{var l=h[d-15],g=(l<<25|l>>>7)^(l<<14|l>>>18)^l>>>3,m=h[d-2],y=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;h[d]=g+h[d-7]+y+h[d-16]}var w=n&i^n&a^i&a,v=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),b=f+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&u^~s&p)+c[d]+h[d];f=p,p=u,u=s,s=o+b|0,o=a,a=i,i=n,n=b+(v+w)|0}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+a|0,r[3]=r[3]+o|0,r[4]=r[4]+s|0,r[5]=r[5]+u|0,r[6]=r[6]+p|0,r[7]=r[7]+f|0},_doFinalize:function(){var e=this._data,r=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return r[i>>>5]|=128<<24-i%32,r[14+(i+64>>>9<<4)]=t.floor(n/4294967296),r[15+(i+64>>>9<<4)]=n,e.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var t=a.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA256=a._createHelper(u),e.HmacSHA256=a._createHmacHelper(u)}(Math),n.SHA256)},245:(t,e,r)=>{"use strict";function n(t){this.message=t}r.r(e),r.d(e,{InvalidTokenError:()=>o,default:()=>s}),n.prototype=new Error,n.prototype.name="InvalidCharacterError";var i="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(t){var e=String(t).replace(/=+$/,"");if(e.length%4==1)throw new n("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,i,a=0,o=0,s="";i=e.charAt(o++);~i&&(r=a%4?64*r+i:i,a++%4)?s+=String.fromCharCode(255&r>>(-2*a&6)):0)i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(i);return s};function a(t){var e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(i(t).replace(/(.)/g,(function(t,e){var r=e.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(e)}catch(t){return i(e)}}function o(t){this.message=t}o.prototype=new Error,o.prototype.name="InvalidTokenError";const s=function(t,e){if("string"!=typeof t)throw new o("Invalid token specified");var r=!0===(e=e||{}).header?0:1;try{return JSON.parse(a(t.split(".")[r]))}catch(t){throw new o("Invalid token specified: "+t.message)}}},480:()=>{},596:t=>{"use strict";t.exports=JSON.parse('{"id":"picacomic","name":"嗶咔漫畫","website":"https://www.picacomic.com/","version":"0.0.1","language":"zh","iconUrl":"https://raw.githubusercontent.com/tachiyomiorg/tachiyomi-extensions/master/src/zh/picacomic/res/mipmap-hdpi/ic_launcher.png","baseUrl":"https://picaapi.picacomic.com","useCredentials":true}')}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var a=e[n]={exports:{}};return t[n].call(a.exports,a,a.exports,r),a.exports}r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n=r(368);module.exports=n})();